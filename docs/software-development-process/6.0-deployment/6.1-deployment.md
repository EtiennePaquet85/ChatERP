# 🚀 ChatERP – Déploiement

---

## 1. 🎯 Objectif du document

Ce document décrit le processus de déploiement du prototype **ChatERP** dans un environnement cible. 
Il présente les stratégies, les outils, les étapes et les considérations opérationnelles nécessaires à la mise en service du système.

---

## 2. 🌐 Environnements cibles

| Environnement  | Objectif principal                           | Particularités techniques                                  |
|----------------|----------------------------------------------|------------------------------------------------------------|
| Développement  | Tests locaux, validation en cours de codage  | Déploiement manuel ou via script (`dotnet`, `make`, `npm`) |
| Intégration    | Tests d’intégration multi-système            | Connexions entre **Frontend**, **Backend**, **Database**   |
| Préproduction  | Simulation en conditions réelles             | Préparation pour validation complète                       |
| Production     | Mise à disposition pour utilisateur final    | Hébergement simplifié (ex: VPS, Docker)                    |

---

## 3. 🧩 Objectifs de déploiement

| ID         | Objectif                       | Description                                                                           | Alignement                        |
|------------|--------------------------------|---------------------------------------------------------------------------------------|-----------------------------------|
| DEP-OBJ-01 | Reproductibilité               | Permettre un déploiement identique dans tout environnement compatible                 | REQ-NF-01, REQ-NF-03              |
| DEP-OBJ-02 | Simplicité d’exécution         | Offrir une commande unique (`chaterp-compose up`) pour tout lancer                    | REQ-F-06, REQ-NF-03, REQ-CONT-04  |
| DEP-OBJ-03 | Testabilité                    | Intégrer les tests automatisés à l’environnement de déploiement                       | REQ-NF-02, REQ-NF-03, REQ-CONT-03 |
| DEP-OBJ-04 | Traçabilité des environnements | Documenter les variables, ports et options de chaque composant déployé                | REQ-NF-03, REQ-CONT-02            |
| DEP-OBJ-05 | Maintenance facilitée          | Permettre des mises à jour, ajouts ou rollback sans perturber l’ensemble du système   | REQ-NF-02, REQ-NF-04              |
| DEP-OBJ-06 | Accessibilité multiplateforme  | Offrir un accès distant depuis tout appareil via l’URL locale ou réseau               | REQ-F-05, REQ-NF-05               |
| DEP-OBJ-07 | Livraison continue contrôlée   | Intégrer toute version déployée à une chaîne de validation et d’exécution automatisée | REQ-NF-03, REQ-CONT-02            |

---

## 4. 📦 Structure des artefacts à déployer

| Composant     | Format déployé                              | Outil utilisé            | Dossier source                          |
|---------------|---------------------------------------------|--------------------------|-----------------------------------------|
| **Backend**   | Exécutable `.dll` ASP.NET Core              | `dotnet publish`         | `systems/backend/chaterp-server/`       |
| **Database**  | Application FastAPI ou scripts              | `uvicorn`, `Docker`, SQL | `systems/database/chaterp-persistence/` |
| **Frontend**  | Fichiers statiques (`.js`, `.css`, `.html`) | `npm build` / `Vite`     | `systems/frontend/chaterp-web/`         |

---

## 5. ⚙️ Procédures de déploiement

### 5.1 📁 Déploiement manuel sans Docker

> ⚙️ **But** : Démarrer manuellement les 3 systèmes du prototype ChatERP (backend, database, frontend) en mode développement, **sans Docker**.

---

#### 🔧 A. Étapes à faire une seule fois (prérequis)

##### 1. 🧠 Installer les dépendances du backend (C# / .NET)

~~~
cd systems/backend/chaterp-server
dotnet restore
~~~

##### 2. 🐍 Installer les dépendances de la database (Python / FastAPI)

- Linux/macOS :
  ~~~
  cd systems/database/chaterp-persistence
  python -m venv .venv
  source .venv/bin/activate
  pip install -r requirements.txt
  ~~~
- Windows PowerShell :
  ~~~
  cd systems/database/chaterp-persistence
  python -m venv .venv
  .venv\Scripts\Activate.ps1
  pip install -r requirements.txt
  ~~~
- Windows Command Prompt (cmd.exe) :
  ~~~
  cd systems/database/chaterp-persistence
  python -m venv .venv
  .venv\Scripts\activate.bat
  pip install -r requirements.txt
  ~~~
- Windows Git Bash (MINGW64) :
  ~~~
  cd systems/database/chaterp-persistence
  python -m venv .venv
  source .venv/Scripts/activate
  pip install -r requirements.txt
  ~~~

##### 3. ⚛️ Installer les dépendances du frontend (React / Vite)

~~~
cd systems/frontend/chaterp-web
npm install
~~~

---

#### 🔁 B. Étapes à faire à chaque lancement

##### 1. 🧠 Lancer le backend (.NET)

~~~
cd systems/backend/chaterp-server
dotnet build
dotnet run
~~~

> 🌐 Backend accessible via : http://localhost:5000  
> 📘 Documentation Swagger : http://localhost:5000/swagger/index.html

---

##### 2. 🐍 Lancer la database (FastAPI)

- Linux/macOS :
  ~~~
  cd systems/database/chaterp-persistence
  source .venv/bin/activate
  make build
  make run
  ~~~
- Windows PowerShell :
  ~~~
  cd systems/database/chaterp-persistence
  .venv\Scripts\Activate.ps1
  make build
  make run
  ~~~
- Windows Command Prompt (cmd.exe) :
  ~~~
  cd systems/database/chaterp-persistence
  .venv\Scripts\activate.bat
  make build
  make run
  ~~~
- Windows Git Bash (MINGW64) :
  ~~~
  cd systems/database/chaterp-persistence
  source .venv/Scripts/activate
  make build
  make run
  ~~~

> 🌐 Database accessible via : http://localhost:8000  
> 📘 Documentation Swagger : http://localhost:8000/swagger/index.html

---

##### 3. ⚛️ Lancer le frontend (Vite)

~~~
cd systems/frontend/chaterp-web
npm run build
npm run dev
~~~

> 🌐 Frontend accessible via : http://localhost:5173

---

### 5.2 📁 Déploiement manuel avec Docker

> ⚙️ **But** : Démarrer manuellement les 3 systèmes du prototype ChatERP (backend, database, frontend) en mode développement, **avec Docker**.

---

#### 🔨 A. Construire manuellement les images

~~~
docker build -t chaterp-backend systems/backend/chaterp-server
docker build -t chaterp-database systems/database/chaterp-persistence
docker build -t chaterp-frontend systems/frontend/chaterp-web
~~~

---

#### 🚀 B. Démarrer manuellement les conteneurs

1️⃣ Base de données :

~~~
docker run -d -p 8000:80 --name chaterp-database chaterp-database
~~~

2️⃣ Backend :

~~~
docker run -d -p 5000:80 --name chaterp-backend --link chaterp-database chaterp-backend
~~~

3️⃣ Frontend :

~~~
docker run -d -p 5173:80 --name chaterp-frontend --link chaterp-backend chaterp-frontend
~~~

> 🌐 Vérifie que les services répondent à :
> - http://localhost:5000 (backend)
> - http://localhost:8000 (database)
> - http://localhost:5173 (frontend)

---

### 5.3 📁 Déploiement automatique avec Docker Compose

> ⚙️ **But** : Démarrer automatiquement les 3 systèmes du prototype ChatERP (backend, database, frontend) en mode développement, **avec une seule commande**.

---

#### 🚀 A. Lancer tous les services

~~~
docker-compose up --build
~~~

- Backend : http://localhost:5000  
- Database : http://localhost:8000  
- Frontend : http://localhost:5173

---

#### 🛑 B. Arrêter tous les services

~~~
docker-compose down
~~~

Cela stoppe et supprime les conteneurs, mais conserve les volumes et les images Docker.

---

### 5.4 🚀 Déploiement validé avec `chaterp-compose`

> 🧪 **But** : Automatiser le déploiement en exécutant tous les tests unitaires et d’intégration **avant** de lancer les services avec Docker Compose. Ce processus permet de garantir que le code est valide avant de démarrer les conteneurs.


#### ✅ A. Lancer tous les services avec validation préalable

Depuis la racine du projet, lancez :

~~~
dotnet run --project docker/chaterp-compose
~~~

Ce programme personnalisé `.NET` réalise automatiquement les étapes suivantes :

1. ✅ Exécute les tests automatisés pour le Backend, la Database et le Frontend
2. 🛠️ Construit les images Docker pour chaque composant
3. 📦 Publie les images vers le registre Docker
4. 🧱 Démarre les conteneurs via Docker Compose

> 🌐 Accès aux services :
> - Backend : http://localhost:5000  
> - Database : http://localhost:8000  
> - Frontend : http://localhost:5173

#### ⚠️ B. Différence avec `docker-compose up`

| Commande                                      | Exécute les tests  | Construit les images | Lance les services  |
|-----------------------------------------------|--------------------|----------------------|---------------------|
| `dotnet run --project docker/chaterp-compose` | ✅ Oui             | ✅ Oui              | ✅ Oui              |
| `docker-compose up --build`                   | ❌ Non             | ✅ Oui              | ✅ Oui              |

#### 🛑 C. Arrêt des services

Comme pour Docker Compose :

~~~
docker-compose down
~~~

#### 📋 Résumé

L’outil `chaterp-compose` doit être utilisé comme **pipeline local sécurisé**, garantissant un démarrage propre et testé du système :

- 💡 À utiliser en intégration ou préproduction
- 🔄 Complémentaire à `docker-compose` (plus rapide mais non validé)

---

## 6. ☁️ Déploiement sur Render.com

Le projet **ChatERP** est déployé sur la plateforme cloud [Render](https://render.com/) dans deux environnements séparés : **Développement** et **Production**.

---

### 6.1 🔧 Environnement de Développement (Dev)

Trois services sont déployés **manuellement** via l’interface Render, à partir d’images Docker publiées sur Docker Hub :

- `chaterp-web` (Frontend React)  
  ➜ [https://chaterp-web.onrender.com](https://chaterp-web.onrender.com)  
- `chaterp-server` (Backend .NET)  
  ➜ [https://chaterp-server.onrender.com](https://chaterp-server.onrender.com)  
- `chaterp-persistence` (Database FastAPI)  
  ➜ [https://chaterp-persistence.onrender.com](https://chaterp-persistence.onrender.com)  

---

### 6.2 🚀 Environnement de Production (Prod)

Trois services sont déployés **automatiquement** via le dépôt Git, à partir de la version stable de ChatERP :

- `chaterp-frontend` (Frontend React)  
  ➜ [https://chaterp-frontend.onrender.com](https://chaterp-frontend.onrender.com)  
- `chaterp-backend` (Backend .NET)  
  ➜ [https://chaterp-backend.onrender.com](https://chaterp-backend.onrender.com)  
- `chaterp-database` (Database FastAPI)  
  ➜ [https://chaterp-database.onrender.com](https://chaterp-database.onrender.com)  

> 🛠️ Le déploiement est déclenché automatiquement à chaque mise à jour de la branche `main`, à l’aide d’un fichier `render.yaml` versionné dans le dépôt Git.

---

### 6.3 🌍 Noms de domaine personnalisés

L’application est également accessible via des **noms de domaine personnalisés** :

- [https://www.chaterp.app](https://www.chaterp.app) → domaine principal  
- [https://chaterp.app](https://chaterp.app) → redirige automatiquement vers `www.chaterp.app`

Les deux domaines sont **vérifiés** et **sécurisés par certificat SSL** via Render.

---

## 7. 🔗 Connexions entre systèmes

- ✅ Le **Frontend** appelle le **Backend** via `http://localhost:5173` :  
  > Exemple : `POST http://localhost:5173/api/employees`  
  > Corps JSON : `{ "name": "Alice Martin", "role": "Développeuse", ... }`  
  > ℹ️ Cette approche nécessite que le **Backend autorise les requêtes cross-origin** (CORS) depuis `http://localhost:5173`.

- ✅ Le **Backend** appelle la **Database** via `http://localhost:8000` :  
  > Exemple : `POST http://localhost:8000/api/employees`  
  > Corps JSON : `{ "name": "Alice Martin", "role": "Développeuse", ... }`

---

## 8. 🔒 Sécurité minimale

| Mesure                  | Application     | Description                            |
|-------------------------|-----------------|----------------------------------------|
| CORS                    | Backend         | Restriction des origines acceptées     |
| Authentification        | Tous (à venir)  | Prévu pour la version post-prototype   |
| Accès API               | Database        | Limitation des actions via routes REST |

---

## 9. 🧩 Alignement SWEBOK

Ce plan de déploiement respecte les principes de la discipline *Software Engineering Operations*, notamment :
- la séparation entre environnements,
- la reproductibilité du déploiement,
- la traçabilité entre livrables et exécutions.

---

## 10. 🔚 Conclusion

Ce plan de déploiement propose une méthode fiable et reproductible pour lancer **ChatERP** dans tous les environnements.  

Il combine des outils manuels et automatisés pour garantir qualité, traçabilité et facilité de maintenance.  

Ce document sera mis à jour selon les besoins du projet et l’évolution du système.
