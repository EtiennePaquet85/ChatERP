# 🧱 ChatERP — Construction

---

## 1. 🎯 Objectif du document

Ce document présente la **construction logicielle détaillée** du prototype **ChatERP**, en cohérence avec la structure cible définie dans le projet.  
Il décrit les pratiques de codage, les principes de structuration, les règles de modularisation et les choix techniques appliqués, dans un objectif de qualité, de testabilité et de maintenabilité, selon les recommandations du **SWEBOK v4.0 (2024)**.

---

## 2. 📌 Portée, définitions et références

### 2.1 Portée

Ce document couvre :  

- Les décisions de construction prises pour réaliser le prototype ChatERP  
- La structuration logicielle détaillée de chaque sous-système (Frontend, Backend, Database)  
- La déclinaison des principes de construction selon le SWEBOK v4.0  
- Les justifications techniques des choix de classes, composants et structures utilisées  

### 2.2 Définitions

| Terme     | Définition                                                                                |
|-----------|-------------------------------------------------------------------------------------------|
| Vue       | Composant React affichant l’interface utilisateur et captant les interactions             |
| Métier    | Service central orchestrant les règles métier et la validation                            |
| API       | Routeur FastAPI exposant les endpoints REST côté base de données                          |
| Règles    | Manager Python appliquant la logique métier locale et orchestrant les appels aux données  |
| Stockage  | Repository accédant physiquement aux données via SQLite, en encapsulant les requêtes CRUD |

### 2.3 Références

- Traçabilité [0.2-process-traceability.md]
- Cas d’utilisation [1.3-use-cases.md]  
- Conception [3.1-design.md]
- Guide SWEBOK v4.0 (2024) [IEEE Computer Society]

---

## 3. 🌐 Contexte, objectifs et principes de construction

### 3.1 Contexte

Cette section présente les objectifs et principes appliqués durant la construction logicielle du prototype ChatERP. 

### 3.2 Objectifs et principes de construction combinés

| ID          | Objectif / Principe                       | Description combinée                                                     | Alignement |
|-------------|-------------------------------------------|--------------------------------------------------------------------------|------------|
| CONS-OBJ-01 | Modularité / Responsabilités isolées      | Chaque dossier contient des classes centrées sur un seul rôle            | DES-OBJ-01 |
| CONS-OBJ-02 | Découplage / Composants indépendants      | Dépendances injectées via interfaces, facilitant substitution et tests   | DES-OBJ-02 |
| CONS-OBJ-03 | Maintenabilité / Implémentation contrôlée | Modifications localisées évitent impact sur modules voisins              | DES-OBJ-03 |
| CONS-OBJ-04 | Testabilité / Effets isolés               | Classes testables individuellement, sans dépendances implicites          | DES-OBJ-04 |
| CONS-OBJ-05 | Simplicité / Scripts reproductibles       | Automatisation évitant étapes manuelles et standardisant la construction | DES-OBJ-05 |
| CONS-OBJ-06 | Interopérabilité / Outils agnostiques     | Outils ouverts et multiplateformes (dotnet, pytest, uvicorn)             | DES-OBJ-06 |
| CONS-OBJ-07 | Accessibilité  / Conventions cohérentes   | Nommage, fichiers, structures uniformes et documentées                   | DES-OBJ-07 |

---

## 4. 🧱 Vue d’ensemble

ChatERP est constitué de **trois systèmes indépendants** communiquant exclusivement via HTTP, même localement, garantissant un découplage complet.

### 4.1 Structure de l'application

| Système      | Technologies principales                  | Modules internes                       | Rôle principal                                                                                  |
|--------------|-------------------------------------------|----------------------------------------|-------------------------------------------------------------------------------------------------|
| 🟦 Frontend   | `React (TypeScript)`, React Query, Axios  | `components`, `handlers`, `adapters`   | Interface utilisateur moderne et typée, gestion locale, appels HTTP fiables vers le Backend.    |
| 🟩 Backend    | `ASP.NET Core (C#)`, HttpClient, JSON     | `Controllers`, `Services`, `Clients`   | Point d’entrée HTTP, logique métier centralisée, communication efficace via HttpClient et JSON. |
| 🟨 Database   | `FastAPI (Python)`, SQLite, Pydantic      | `routers`, `managers`, `repositories`  | API REST CRUD, validation stricte des données, gestion efficace de la persistance.              |

### 4.2 Composants principaux

| ID            | Composant   | Système    | Rôle principal                                                                    | Alignement   |
|---------------|-------------|------------|-----------------------------------------------------------------------------------|--------------|
| CONS-COMP-01  | Vue         | Frontend   | Présente l’interface utilisateur et capte les interactions                        | DES-COMP-01  |
| CONS-COMP-02  | Gestion     | Frontend   | Contient la logique de gestion locale et coordonne les échanges internes/externes | DES-COMP-02  |
| CONS-COMP-03  | Transport   | Frontend   | Gère les appels réseau ou les interactions avec des services externes             | DES-COMP-03  |
| CONS-COMP-04  | Entrée      | Backend    | Reçoit les requêtes entrantes, les valide et déclenche le traitement              | DES-COMP-04  |
| CONS-COMP-05  | Métier      | Backend    | Applique les règles métier et orchestre les opérations nécessaires                | DES-COMP-05  |
| CONS-COMP-06  | Accès       | Backend    | Fournit une interface ou des abstractions vers la couche de persistance           | DES-COMP-06  |
| CONS-COMP-07  | API         | Database   | Expose des routes ou fonctions pour manipuler les données                         | DES-COMP-07  |
| CONS-COMP-08  | Règles      | Database   | Implémente la logique métier ou les règles liées à la persistance                 | DES-COMP-08  |
| CONS-COMP-09  | Stockage    | Database   | Gère les opérations physiques sur les données (CRUD, requêtes, stockage)          | DES-COMP-09  |

---

## 5. 🗺️ Stratégie de construction globale

- Ce document couvre la construction du cas d’utilisation **UC01 – Créer un employé**, utilisé pour valider l’architecture et la structure logicielle du projet.  
- L’ensemble des fonctionnalités du module Employé (**UC01 à UC04**, soit le **CRUD complet**) sera implémenté dès la phase initiale, sous forme de **prototype fonctionnel**.  
- Les autres éléments de la construction seront précisés dans des documents complémentaires, chacun dédié à un aspect technique spécifique.

### Documents complémentaires prévus :

| Référence                  | Sujet                       | Description courte                                    |  
|----------------------------|-----------------------------|-------------------------------------------------------|  
| `4.2-projet-structure.md`  | Structure du projet         | Organisation des dossiers, projets et fichiers.       |  
| `4.3-coding-practices.md`  | Pratiques de développement  | Conventions, style de code et gestion de versions.    |  
| `5.1-tests.md`             | Stratégie de tests          | Tests unitaires, tests d’intégration et mocks.        |  
| `5.2-validation.md`        | Validation technique        | Validation des exigences, intégration et conformité.  |  
| `6.1-deployment.md`        | Déploiement                 | CI/CD, mise en production et procédures associées.    |  
| `7.1-maintenance.md`       | Maintenance                 | Suivi, corrections et évolutions post-déploiement.    |

---

## 6. ⚙️ Évaluation des solutions structurelles

### 6.1 Critères de sélection

| Critère       | Description                                                                                                 | Alignement   |
|---------------|-------------------------------------------------------------------------------------------------------------|--------------|
| Structuration | Implémenter une séparation nette des modules physiques pour assurer une maintenance aisée                   | ARC-OBJ-01   |
| Isolation     | Utiliser des interfaces et mécanismes techniques pour minimiser les dépendances directes entre modules      | ARC-OBJ-02   |
| Cohésion      | Organiser le code pour que chaque unité logicielle ait une responsabilité unique et clairement définie      | ARC-OBJ-03   |
| Fiabilité     | Faciliter la mise en œuvre de tests unitaires et d’intégration fiables à travers une architecture solide    | ARC-OBJ-04   |
| Clarté        | Appliquer des pratiques de codage et des standards visant à réduire la complexité et améliorer la qualité   | ARC-OBJ-05   |
| Adaptabilité  | Assurer que le système est construit pour être déployé et utilisé dans différents environnements techniques | ARC-OBJ-06   |
| Lisibilité    | Maintenir un code bien structuré, documenté et conforme aux normes pour faciliter sa compréhension          | ARC-OBJ-07   |

### 6.2 Comparaison des solutions

> Les comparaisons sont basées sur le cas d’utilisation **UC01 – Créer un employé** afin d’illustrer les classes et fichiers requis dans chaque structure.

#### 🟦 Structures Frontend (React + TypeScript)

| Solution | Fichiers / Classes                                                         | Structuration | Isolation | Cohésion | Fiabilité | Clarté | Adaptabilité | Lisibilité | Score | Verdict             |
|----------|----------------------------------------------------------------------------|---------------|-----------|----------|-----------|--------|--------------|------------|-------|---------------------|
| A        | `EmployeeForm.tsx`, `useEmployee.ts`, `api.ts`                             | ✅            | ✅        | ✅      | ✅        | ⚠️     | ✅          | ✅         | 4.4   | Alternative valable |
| **B**    | `EmployeeComponent.tsx`, `employeeHandler.ts`, `httpEmployeeApiAdapter.ts` | ✅            | ✅        | ✅      | ✅        | ✅     | ✅          | ✅         | 4.7   | ✅ Solution retenue |
| C        | `EmployeeComponent.tsx`, `store.ts`, `reduxSlice.ts`                       | ✅            | ✅        | ✅      | ✅        | ⚠️     | ✅          | ✅         | 4.3   | Complexité inutile  |

#### 🟩 Structures Backend (ASP.NET Core C#)

| Solution | Fichiers / Classes                                                         | Structuration | Isolation | Cohésion | Fiabilité | Clarté | Adaptabilité | Lisibilité | Score | Verdict              |
|----------|----------------------------------------------------------------------------|---------------|-----------|----------|-----------|--------|--------------|------------|-------|----------------------|
| A        | `EmployeeController.cs`, `UseCaseCreateEmployee.cs`                        | ✅            | ✅        | ✅      | ✅        | ⚠️     | ✅          | ✅         | 4.5   | Alternative robuste  |
| **B**    | `EmployeeController.cs`, `EmployeeService.cs`, `HttpEmployeeApiClient.cs`  | ✅            | ✅        | ✅      | ✅        | ✅     | ✅          | ✅         | 4.7   | ✅ Solution retenue  |
| C        | `EmployeeCommand.cs`, `EmployeeHandler.cs`, `IMediator.cs`                 | ⚠️            | ✅        | ✅      | ✅        | ❌     | ✅          | ✅         | 4.1   | Complexité excessive |

#### 🟨 Structures Database (FastAPI Python)

| Solution | Fichiers / Classes                                                         | Structuration | Isolation | Cohésion | Fiabilité | Clarté | Adaptabilité | Lisibilité | Score | Verdict               |
|----------|----------------------------------------------------------------------------|---------------|-----------|----------|-----------|--------|--------------|------------|-------|-----------------------|
| A        | `employee_router.py`, `employee_logic.py`, `crud.py`                       | ✅            | ✅        | ✅      | ✅        | ⚠️     | ✅          | ✅         | 4.4   | Alternative possible  |
| **B**    | `employee_router.py`, `employee_manager.py`, `employee_repository.py`      | ✅            | ✅        | ✅      | ✅        | ✅     | ✅          | ✅         | 4.7   | ✅ Solution retenue   |
| C        | `api.py`, `models.py`, `main.py`                                           | ⚠️            | ⚠️        | ✅      | ⚠️        | ✅     | ✅          | ⚠️         | 3.9   | Structure trop floue  |

> 📝 **Notation** :  
> - ✅ : Répond pleinement au critère  
> - ⚠️ : Répond partiellement ou avec compromis  
> - ❌ : Ne répond pas au critère  
> Le **score final** est une moyenne sur 7 critères.

### 6.3 Solution retenue

🟦 Frontend — B : `EmployeeComponent.tsx`, `employeeHandler.ts`, `httpEmployeeApiAdapter.ts`  
🟩 Backend — B : `EmployeeController.cs`, `EmployeeService.cs`, `HttpEmployeeApiClient.cs`  
🟨 Database — B : `employee_router.py`, `employee_manager.py`, `employee_repository.py`  

💡 Cette solution structurelle s’appuie sur neuf classes clés, réparties selon les modules de chaque système. Elle concrétise une architecture cohérente, claire et maintenable, conforme aux principes de construction du prototype **ChatERP**.

---

## 7. 🔍 Décisions de construction

Les décisions suivantes précisent les **classes principales mises en œuvre** dans chaque sous-système pour réaliser les modules définis, conformément aux principes de construction établis.  
Elles s’appliquent au cas d’utilisation **UC01 – Créer un employé**, premier cas implémenté dans le prototype.

| ID           | Classe                          | Système    | Décision de construction principale                                          | Alignement     |
|--------------|---------------------------------|------------|------------------------------------------------------------------------------|----------------|
| CONS-DEC-01  | `EmployeeComponent.tsx`         | Frontend   | Composant React dédié à l’interface de saisie d’un employé                   | CONS-COMP-01   |
| CONS-DEC-02  | `employeeHandler.ts`            | Frontend   | Gestionnaire de logique métier client, assurant traitement et validation     | CONS-COMP-02   |
| CONS-DEC-03  | `httpEmployeeApiAdapter.ts`     | Frontend   | Adaptateur HTTP chargé des communications réseau avec le Backend             | CONS-COMP-03   |
| CONS-DEC-04  | `EmployeeController.cs`         | Backend    | Contrôleur ASP.NET recevant, validant et transmettant les requêtes API       | CONS-COMP-04   |
| CONS-DEC-05  | `EmployeeService.cs`            | Backend    | Service métier orchestrant le traitement et la validation côté serveur       | CONS-COMP-05   |
| CONS-DEC-06  | `HttpEmployeeApiClient.cs`      | Backend    | Client HTTP vers la Database, encapsulant les appels réseau descendents      | CONS-COMP-06   |
| CONS-DEC-07  | `employee_router.py`            | Database   | Routeur FastAPI exposant les endpoints employés côté base de données         | CONS-COMP-07   |
| CONS-DEC-08  | `employee_manager.py`           | Database   | Gestionnaire métier coordonnant les traitements et validations locales       | CONS-COMP-08   |
| CONS-DEC-09  | `employee_repository.py`        | Database   | Répertoire de persistance pour l’accès aux données employés via SQLite       | CONS-COMP-09   |

---

## 8. 🗂️ Diagrammes de construction

| Diagramme                | Fichier associé                    | Description                                     |
|--------------------------|------------------------------------|-------------------------------------------------|
| Diagramme de classes     | `class-diagram-uc01.puml`          | Diagramme de classes – Création d’employé       |
| Diagramme de classes     | `class-diagram-uc02.puml`          | Diagramme de classes – Consultation d’employé   |
| Diagramme de classes     | `class-diagram-uc03.puml`          | Diagramme de classes – Mise à jour d’employé    |
| Diagramme de classes     | `class-diagram-uc04.puml`          | Diagramme de classes – Suppression d’employé    |
| Diagramme de séquence    | `sequence-diagram-uc01.puml`       | Diagramme de séquence – Création d’employé      |
| Diagramme de séquence    | `sequence-diagram-uc02.puml`       | Diagramme de séquence – Consultation d’employé  |
| Diagramme de séquence    | `sequence-diagram-uc03.puml`       | Diagramme de séquence – Mise à jour d’employé   |
| Diagramme de séquence    | `sequence-diagram-uc04.puml`       | Diagramme de séquence – Suppression d’employé   |

📁 Fichiers disponibles dans `docs/software-diagrams/4.0-construction/`

---

## 9. 🔚 Conclusion

Le présent document formalise l’ensemble des pratiques de **construction logicielle** pour le prototype **ChatERP**, en garantissant :

* Une traçabilité complète des composants aux scripts et tests  
* Une implémentation rigoureusement alignée sur la conception  
* Une transition fluide vers l’intégration fonctionnelle  
